# BiathlonSim: Прототип системы для симуляции биатлонных соревнований

Прототип системы, разработанный на Go, для симуляции биатлонных соревнований на основе конфигурационного файла и файла событий. Программа обрабатывает хронологию гонки, отслеживает состояние спортсменов и генерирует итоговые отчеты.

## Особенности

* Чтение параметров гонки из файла `config.json`.
* Обработка последовательности событий спортсменов из файла `events`.
* Расчет времени кругов, средней скорости, штрафного времени и результатов стрельбы.
* Генерация подробного лога событий гонки.
* Формирование итоговой таблицы результатов с сортировкой по времени финиша.
* Поддержка статусов спортсменов: финишировал, не стартовал (`NotStarted`), не финишировал (`NotFinished`), дисквалифицирован (`Disqualified`).
* Написаны юнит-тесты для ключевых модулей.

## Вводные данные
### Конфигурация (json)

Файл `config.json` определяет основные параметры гонки:

* **`Laps`**: Количество основных кругов дистанции.
* **`LapLen`**: Длина каждого основного круга (в метрах).
* **`PenaltyLen`**: Длина каждого штрафного круга (в метрах).
* **`FiringLines`**: Количество огневых рубежей на каждом круге.
* **`Start`**: Плановое время старта первого спортсмена (формат `ЧЧ:ММ:СС` или `ЧЧ:ММ:СС.ммм`).
* **`StartDelta`**: Плановый интервал между стартами спортсменов (формат `ЧЧ:ММ:СС`).

Пример `config.json`:
```json
{
    "laps": 2,
    "lapLen": 3500,
    "penaltyLen": 150,
    "firingLines": 2,
    "start": "10:00:00.000",
    "startDelta": "00:01:30"
}
```

### События (`events`)

Файл `events` содержит хронологический список всех событий, произошедших во время гонки. Каждая строка в файле представляет одно событие и должна соответствовать определенному формату.

* **Последовательность:** Все события должны быть упорядочены по времени (время события N+1 >= времени события N).
* **Формат времени:** `[ЧЧ:ММ:СС.ммм]`. Требуются нули в конце миллисекунд (например, `.100`, а не `.1`).
* **Общий формат строки события:**
  `[время] ID_события ID_спортсмена [дополнительные_параметры]`

**Типы входящих событий и их параметры:**

| EventID | `extraParams` (Доп. параметры) | Комментарий                                                                 |
| :------ | :------------------------------ | :------------------------------------------------------------------------- |
| `1`     |                                 | Спортсмен зарегистрирован в системе.                                       |
| `2`     | `startTime` (ЧЧ:ММ:СС.ммм)      | Плановое время старта для спортсмена было установлено жеребьевкой.           |
| `3`     |                                 | Спортсмен находится на линии старта, готов к началу гонки.                   |
| `4`     |                                 | Спортсмен фактически стартовал.                                            |
| `5`     | `firingRange` (целое число)     | Спортсмен прибыл на огневой рубеж. Параметр указывает номер рубежа (например, 1, 2). |
| `6`     | `target` (целое число)          | Мишень поражена спортсменом. Параметр указывает номер пораженной мишени.     |
| `7`     |                                 | Спортсмен покинул огневой рубеж.                                           |
| `8`     |                                 | Спортсмен зашел на штрафные круги.                                          |
| `9`     |                                 | Спортсмен покинул зону штрафных кругов.                                    |
| `10`    |                                 | Спортсмен завершил очередной основной круг дистанции.                        |
| `11`    | `comment` (строка)              | Спортсмен не может продолжать гонку (сход с дистанции). Параметр – причина. |

**Важно по статусам:**
* Если спортсмен не стартует в свой стартовый интервал (не получает событие `4` после события `2` в разумное время), он помечается как **`NotStarted`** в итоговом отчете.
* Если для спортсмена приходит событие `11`, он помечается как **`NotFinished`** в итоговом отчете.

**Пример содержимого файла `events`:**

```text
[09:05:59.867] 1 1
[09:15:00.841] 2 1 09:30:00.000
[09:29:45.734] 3 1
[09:30:01.005] 4 1
[09:49:31.659] 5 1 1
[09:49:33.123] 6 1 1
[09:49:34.650] 6 1 2
[09:49:35.937] 6 1 4
[09:49:37.364] 6 1 5
[09:49:38.339] 7 1
[09:49:55.915] 8 1
[09:51:48.391] 9 1
[09:59:03.872] 10 1
[09:59:03.872] 11 1 Lost in the forest
```

## Сборка и запуск

### Требования
* Go версии 1.20 или новее.

### Инструкции по сборке

1.  **Клонируйте репозиторий (если он есть) или создайте директорию проекта `BiathlonSim` и поместите в нее все `.go` файлы, `go.mod`, `config.json`, и `events`.**

2.  **Перейдите к корню проекта**

3.  **Загрузите зависимости:**
    ```bash
    go mod tidy
    ```

4.  **Соберите исполняемый файл:**
    ```bash
    go build
    ```

### Инструкция по запуску скомпилированной программы


**Варианты запуска:**

1.  **Запуск с файлами `config.json` и `events` по умолчанию:**
    Если файлы `config.json` и `events` находятся в той же директории, что и исполняемый файл `BiathlonSim`, выполните:

    * Для Linux/macOS:
        ```bash
        ./BiathlonSim
        ```
    * Для Windows:
        ```bash
        .\BiathlonSim.exe
        ```

2.  **Запуск с указанием конкретных файлов конфигурации и событий:**
    Вы можете явно указать пути к файлам `config.json` и `events` с помощью флагов `-config` и `-events`:

    * Для Linux/macOS:
        ```bash
        ./BiathlonSim -config=/полный/путь/к/input/config.json -events=/полный/путь/к/input/events
        ```
        Или используя относительные пути (из корня проекта):
        ```bash
        ./BiathlonSim -config=./input/config.json -events=./input/events
        ```

    * Для Windows:
        ```bash
        .\BiathlonSim.exe -config=C:\полный\путь\к\config.json -events=C:\путь\к\events
        ```
        Или используя относительные пути (из корня проекта):
        ```bash
        .\BiathlonSim.exe -config=.\input\config.json -events=.\input\events
        ```

**Что ожидать после запуска:**

Программа сначала выведет в консоль "Output log" (подробный лог обработанных событий в человекочитаемом формате), а затем "Resulting table" (итоговую таблицу результатов соревнований с заголовками колонок).
